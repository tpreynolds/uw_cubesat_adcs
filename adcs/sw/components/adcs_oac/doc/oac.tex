\documentclass[12pt]{article}

% Load commands & pakcages
\input{packages.tex}
\input{commands.tex}
%\input{mikz.tex}
\newcommand{\ttt}[1]{\texttt{#1}}

\addbibresource{PDG.bib}

\title{SOAC: SOC-i Optimal Attitude Controller}

 \author{
  Taylor P. Reynolds%
  \thanks{Doctoral Student, W.E. Boeing Department of Aeronautics \& Astronautics: \texttt{tpr6@uw.edu} } 
\\
  {\normalsize\itshape
  RAIN Lab -- University of Washington}
 }
 \date{\today}

\begin{document}
 
\maketitle

The continuous time optimal control problem to be solved is as follows. 
\begin{problem}\label{prob:prob1}
Find the time $\tf\in(\ti,\tfmax]$ and torque commands $\uB : (\ti,\tfmax] \rightarrow \real^3$ such that
\begin{subequations}
\begin{align}
\min_{\tf,\uB(\cdot)} &\quad \tf \\
\text{subject to} &\quad \qdot = \frac{1}{2} \q \otimes \wB\\
&\quad J \wdot = \uB - \wB^{\times} J \wB \\
&\quad \| \wB \|_{\infty} \leq \wmax \\
&\quad \| \uB \|_{\infty} \leq \umax \\
&\quad \q^T \ME \q < 2 \\
&\quad \q^T \MI \q < 2 \\
&\quad \tfmin \leq \tf \leq \tfmax \\
&\quad \q(\ti) = \q_0,\, \q(\tf) = \q_f,\,\wB(\ti) = \wB(\tf) = 0.
\end{align}
\end{subequations}
\end{problem} 

\paragraph{Linearization}
We refer to our \textit{state} as $\bm{x} = \big[ \q \; \wB \big]^T \in \real^7$ and our \textit{control} as $\bm{u} = \uB \in \real^3$. 


\paragraph{Discretization}

Without any (active) state constraints, we now that the optimal torque solution for the time-optimal reorientation is bang-bang. As such, we will elect to parameterize our control with either piecewise constant or piecewise linear basis functions. This amounts to discretizing our system using a zeroth order hold (ZOH) or a first order hold (FOH), respectively. 

First, we split the maneuver into $N$ evenly spaced temporal intervals. Since we will ultimately linearize the kinematics and dynamics, we want to choose $N$ such that over each interval this linearization remains valid. Given $\q(\ti)$ and $\q(\tf)$, we can compute the angle error between these according to
\begin{equation}
\varphi_{err} = 2*\cos^{-1} \left( \big[ \q(\tf)^* \otimes \q(\ti) \big]_{\text{s}} \right),
\label{eq:err_angle}
\end{equation}
where the operation $[\cdot]_{\text{s}}$ extracts the scalar part of a quaternion. Assuming that a linearization is valid over $\zeta$ degrees, the number of discretization nodes is computed as 
\begin{equation}
N = \lceil \frac{\varphi_{err}}{\zeta} \rceil.
\label{eq:N}
\end{equation}

We now discretize time into $N$ evenly spaced intervals 
\begin{equation}
\ti < t_1 < \ldots < t_{N-1} < \tf
\end{equation}
and represent the discretized time using $k \definedas t_k$. Now, instead of the \textit{continuous times} $t\in(\ti,\tf]$, we have the \textit{discrete times} $k\in\{\ti,\,t_1,\,\ldots,\,t_{N-1},\,\tf\}$.

I'm leaving out a bunch of details for now, but the discretization method leads to
\begin{equation}
\bm{X} = A \bm{X} + B \bm{U} + S s + \bm{Z}
\label{eq:discrete_dynamics}
\end{equation}
where $\{A,B,S,Z\}$ are computed in the code by either \code{zoh.m} or \code{foh.m}. The constraints are all ``discretized'' by simply applying them at the discrete temporal nodes only. 

\paragraph{Virtual Control}

To guide the convergence process, we introduce a new term to address the issue of \textit{artificial infeasibility}. This stems from the fact that the linearization may produce an infeasible interation if there does not exists some admissible control that satisfies~\eqref{eq:discrete_dynamics}. We augment the dynamics with a virtual control term that allows us to synthetically retain feasibility according to
\begin{equation}
\bm{X} = A \bm{X} + B \bm{U} + S s + \bm{Z} + \bm{V}
\label{eq:VC_discrete_dynamics}
\end{equation}
where $\bm{V}$ can be thought of as an unconstrained input that needn't respect the physical dynamics of the problem. We heavily penalize the use of virtual control (so that we only use it when absolutely necessary) by augmenting the cost function to be $\tf + \wv \| \bm{V} \|_1$.

After these modifications, we now have a convex parameter optimization problem that can be run on-board the spacecraft. 

\begin{problem}
Find the final time $s$ and the control $\bm{U}\in\real^{3 \times N}$ such that
\begin{subequations}
\begin{align}
\min_{s,\bm{U},\bm{X},\bm{V}} &\quad s + \wv \| \bm{V} \|_1 \\
\text{subject to:} &\quad \bm{X} = A \bm{X} + B \bm{U} + S s + \bm{Z} + \bm{V} \\
&\quad \| \Hw \bm{x}_k \|_{\infty} \leq \wmax, \quad k=0,\ldots,N \\ 
&\quad \| \bm{u}_k \|_{\infty} \leq \umax, \quad k=0,\ldots,\{N \text{ or } N-1\} \\
&\quad \bm{x}_k^T \Hq^T \ME \Hq \bm{x}_k < 2, \quad k=0,\ldots,N \\
&\quad \bm{x}_k^T \Hq^T \MI \Hq \bm{x}_k < 2, \quad k=0,\ldots,N \\
&\quad \tfmin \leq s \leq \tfmax \\
&\quad \bm{x}_0 = \big[ \q_0^T \; 0^T \big]^T, \; \bm{x}_N = \big[ \q_f^T \; 0^T \big]^T
\end{align}
\end{subequations}
where $\bm{X} = \big[ \bm{x}_0^T \; \bm{x}_1^T \; \ldots \; \bm{x}_{N}^T ]^T \in \real^{7 \times N}$ and similarly for $\bm{U}$. Moreover, $\Hq = \big[ \eye{4} \; \zeros{4}{3} \big]$ and $\Hw = \big[ \zeros{3}{4} \; \eye{3} \big]$.
\end{problem}

\paragraph{Standard Form of Constraints}


\end{document}